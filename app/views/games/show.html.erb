<script>

$(function () {

  function nextTurn() {
    let whoseTurn = $( ".whose-turn" );
    jQuery.data( whoseTurn, "updatedTurn", {
      first: "your-turn",
      last: "opponent-turn"
    });
    if(whoseTurn.html() === "your-turn") {
      $(whoseTurn.html( jQuery.data( whoseTurn, "updatedTurn" ).last ));
    } else if(whoseTurn.html() === "opponent-turn") {
      $(whoseTurn.html( jQuery.data( whoseTurn, "updatedTurn" ).first ));
    }
  }
  function switchTurnDisplay() {
    if($( "#turn-on" ).html() === "Time to fight!") {
      $( "#turn-on" ).html("Now roll with the punches...")
    } else if($( "#turn-on" ).html() === "Now roll with the punches...") {
      $( "#turn-on" ).html("Time to fight!")
    }
  }

  function setup () {
    $('.player-pieces').draggable({
      snap: '.square',
      start: function(e, ui) {
        if($(".whose-turn" ).html() === "opponent-turn") {
          e.preventDefault();
        }
      }
    });

    $('.square').droppable({
      drop: function( event, ui ) {
        const square = this
        const icon = ui.draggable
        const sq_rank = $(square).data('rank')
        const sq_file = $(square).data('file')
        $.ajax({
          type: 'PUT',
          url: icon.data('update-url'),
          dataType: 'script',
          data: { piece: { rank: sq_rank, file: sq_file } }
        }).done(nextTurn(), switchTurnDisplay())
      }
    });

    $('.piece-icon').each( function() {
      var o = $(this);
      if( ! o.attr('title') && o.attr('alt') ) o.attr('title', o.attr('alt') );
    });
  }

  $(function() {
    setup()
  });

});
  
</script>

<div class="row">

  <div class="col-8 placeholder">

    <!-- Game Selection Modal or Drop-down -->

    <div class="placeholder">
      <p>Game Name + Game Selector Drop Down or Modal</p>
    </div>

    <!-- Game Board -->

    <div class="chessboard">

      <div class="grid">
        <%= render partial: "grid", locals: {game: current_game} %>
      </div>

    </div>

    <!-- Challenges Feed -->

    <div class="placeholder">
      <p>Challenges Feed/Current Games List</p>
    </div>
  </div>

  <div class="col-4 placeholder">

    <!-- Player Name Display -->

    <div class="placeholder">
      <h1>White Player</h1> <h3>vs.</h3> <h1>Black Player</h1>
    </div>

    <div class="placeholder">
      <p class="whose-turn"><%= @turn %></p> <!-- Even though it shouldn't display this is necessary -->
      <!-- for nextTurn and setup functions to prevent wrong player from moving -->
      <% if @turn == "your-turn" %>
        <h5 id="turn-on">Time to fight!</h5> <!-- If change in wording; amend switchTurn function accordingly --> 
        <br/>                                <!-- same comment for #turn-off below -->
      <% elsif @turn == "opponent-turn" %>
        <h5 id="turn-off">Now roll with the punches...</h5>
        <br/>
      <% end %>
      <%= @game.turn %>
    </div>

    <!-- Captured Pieces Display -->

    <div class="placeholder captured-display">
      <h5>Captured Pieces</h5>
      <%= render partial: "captured-display", locals: {game: current_game} %>
    </div>

    <!-- Surrender button and modal -->

    <div class="show-button">
      <button>Surrender</button>
    </div>

    <!-- Truce button and modal -->

    <div class="show-button">
      <button>Truce</button>
    </div>

    <!-- Cute image and possibly check/checkmate indicator? -->

    <div class="placeholder show-image">
      <p>Image</p>
    </div>

  </div>

</div>

